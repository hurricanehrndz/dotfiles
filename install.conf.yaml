- defaults:
    link:
      relink: true
      create: true
      force: true

- clean: ['~']

- shell:
  - [git submodule update --init --recursive, Installing submodules]
  -
    command: bash -c "[[ -d ~/.pyenv ]] || git clone https://github.com/pyenv/pyenv ~/.pyenv"
    description: Installing pyenv
  -
    command: bash -c "[[ -d ~/.pyenv/plugins/pyenv-virtualenv ]] || git clone https://github.com/pyenv-virtualenv ~/.pyenv/plugins/pyenv-virtualenv"
    description: Installing pyenv-virtualenv

  -
    command: bash -c "[[ -d ~/.pyenv/plugins/pyenv-update ]] || git clone https://github.com/pyenv-update ~/.pyenv/plugins/pyenv-update"
    description: Installing pyenv-update

  -
    command: bash -c "[[ -d ~/.pyenv/plugins/pyenv-doctor ]] || git clone https://github.com/pyenv-doctor ~/.pyenv/plugins/pyenv-doctor"
    description: Installing pyenv-doctor

  -
    command: bash -c "[[ -d ~/.pyenv/plugins/pyenv-install-latest ]] || git clone https://github.com/pyenv-install-latest ~/.pyenv/plugins/pyenv-install-latest"
    description: Installing pyenv-install-latest

  -
    command: bash -c "[[ -d ~/.pyenv/plugins/pyenv-virtualenvwrapper ]] || git clone https://github.com/pyenv-virtualenvwrapper ~/.pyenv/plugins/pyenv-virtualenvwrapper"
    description: Installing pyenv-virtualenvwrapper

  -
    command: ~/.pyenv/bin/pyenv update
    description: Update pyenv and plugins

- link:
    ~/.tmux.conf:
        path: tmux.conf
    ~/.zprezto:
        path: prezto
    ~/.zshrc:
        create: true
        path:  zshrc
    ~/.zshenv:
        path: zshenv
    ~/.zlogin:
        path: zlogin
    ~/.zlogout:
        path: zlogout
    ~/.zpreztorc:
        path: zpreztorc
    ~/.zprofile:
        path: zprofile
    ~/.gitconfig:
        path: gitconfig
    ~/.dir_colors:
        path: dir_colors
    ~/.gitignore_global:
        path: gitignore_global
    ~/.Xdefaults:
        path: Xdefaults
    ~/.Xresources:
        path: Xresources
    ~/.fonts:
        path: fonts
    ~/.i3:
        path: i3
    ~/bin:
        path: bin
    ~/.zfunc:
        path: zfunc
    ~/.config/mopidy:
        path: mopidy
    ~/.gnupg/gpg.conf:
        path: gnupg/gpg.conf
    ~/.gnupg/gpg-agent.conf:
        path: gnupg/gpg-agent.conf
    ~/.gnupg/dirmngr.conf:
        path: gnupg/dirmngr.conf
    ~/.gnupg/scd-event:
        path: gnupg/scd-event
    ~/.gnupg/scdaemon.conf:
        path: gnupg/scdaemon.conf
    ~/.exports:
        path: exports
    ~/.config/termite:
        path: termite
    ~/.todo/config:
        path: todo/config
    ~/.todo.actions.d:
        path: todo/actions.d
    ~/.config/nvim/init.vim:
        path: nvim/init.vim
    ~/.config/nvim/completion.vim:
        path: nvim/completion.vim
    ~/.vim:
        path: ~/.config/nvim
    ~/.vimrc:
        path: ~/.config/nvim/init.vim
    ~/.ssh/config:
        path: ssh/config
    ~/.config/compton.conf:
        path: compton.conf
    ~/.xsessionrc:
        path: xsessionrc

- shell:
    - mkdir -p ~/.config/nvim/pack/minpac/opt
    - rm -rf ~/.config/nvim/pack/minpac/opt/minpac
    -
      command: git clone --depth 1 https://github.com/k-takata/minpac ~/.config/nvim/pack/minpac/opt/minpac
      description: Installing minpac

    - [nvim -c "call minpac#update()|quit" --headless, Installing vim plugins]
    - [nvim -c "call minpac#update()|quit" --headless, Confirm vim plugin install]

    -
      command: ~/.config/nvim/pack/minpac/start/fzf/install --bin
      description: Install fzf binary

    -
      command: ~/.config/nvim/pack/minpac/start/fzf/install --completion --key-bindings --update-rc --no-bash --no-fish
      description: Configure fzf for zsh

    -
      command: ~/.pyenv/bin/pyenv update
      description: Update all of pyenv

    -
      command: bash -c "[[ $(find ~/.pyenv/versions/ -maxdepth 1 -type d -name \"2.7*\" | wc -l) ]] || ~/.pyenv/bin/pyenv install-latest 2.7"
      description: Installing latest python 2.7

    -
      command: bash -c "[[ $(find ~/.pyenv/versions/ -maxdepth 1 -type d -name \"3.6*\" | wc -l) ]] || ~/.pyenv/bin/pyenv install-latest 3.6"
      description: Installing latest python 3.6

    -
      command: ~/.pyenv/bin/pyenv global ${$(find ~/.pyenv/versions/ -maxdepth 1 -type d -name '2.7*' | tail)##*/} ${$(find ~/.pyenv/versions/ -maxdepth 1 -type d -name '3.6*' | tail)##*/}

      description: Setup Default Python Versions

    -
      command: zsh -c "[[ -d ~/.virtualenvs/neovim2 ]] || { eval $(~/.pyenv/bin/pyenv init -) && pyenv virtualenvwrapper_lazy && mkvirtualenv -p python2 neovim2 }"
      description: Create python2 virtualenv for neovim

    -
      command: ~/.virtualenvs/neovim2/bin/pip install --upgrade neovim
      description: Install python2 neovim plugin

    -
      command: zsh -c "[[ -d ~/.virtualenvs/neovim3 ]] || { eval $(~/.pyenv/bin/pyenv init -) && pyenv virtualenvwrapper_lazy && mkvirtualenv -p python3 neovim3 }"
      description: Create python3 virtualenv for neovim

    -
      command: ~/.virtualenvs/neovim3/bin/pip install --upgrade neovim neovim-remote nodeenv
      description: Install python3 neovim plugin

    -
      command: ~/.pyenv/versions/python3/bin/pip install --upgrade flake8 jedi psutil setproctitle
      description: Install completion manager requirments

    -
      command: zsh -c "eval $(~/.pyenv/bin/pyenv init -); pyenv virtualenvwrapper_lazy; workon neovim3; nodeenv -p; npm install -g bash-language-server;"
      description: "Install bash language server."

    -
      command: zsh -c "eval $(~/.pyenv/bin/pyenv init -); pyenv virtualenvwrapper_lazy; workon neovim3; nodeenv -p; npm install -g dockerfile-language-server-nodejs"
      description: "Install dockerfile language server."

    -
      command: zsh -c "eval $(~/.pyenv/bin/pyenv init -); pyenv virtualenvwrapper_lazy; workon neovim3; nodeenv -p; npm install -g javascript-typescript-langserver"
      description: "Install javascript language server."

    -
      command: chmod 700 ~/.gnupg
      description: Fix home gnupg homedir


- link:
    ~/.local/bin/nvr:
      path: ~/.virtualenvs/neovim3/bin/nvr

    ~/.local/bin/flake8:
      path: ~/.virtualenvs/neovim3/bin/flake8
