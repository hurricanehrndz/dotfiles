#!/bin/bash
# full system backup

# Backup destination
backdest=/home/hurricanehrndz/NetDrives/Backups/HrndzZ230/

# Labels for backup name
#PC=${HOSTNAME}
pc=$(hostname)
distro=debian
type=full
date=$(date "+%F")
backupfile="$backdest/$distro-$type-$date.tar.gz"

# Exclude file location
prog=${0##*/} # Program name from filename
excdir="/home/${USER}/bin/root/backup"
exclude_file="$excdir/${prog}-exc.txt"

# Check if exclude file exists
if [ ! -f $exclude_file ]; then
  echo -n "No exclude file exists, continue? (y/n): "
  read continue
  if [ $continue == "n" ]; then exit; fi
fi

  # -p and --xattrs store all permissions and extended attributes.
  # Without both of these, many programs will stop working!
  # It is safe to remove the verbose (-v) flag. If you are using a
  # slow terminal, this can greatly speed up the backup process.
sudo tar -C / --exclude-from=$exclude_file --xattrs -cp / | \
	openssl enc -e -aes256 -salt | \
	pv -W -s `df -l --block-size=1M --total -x tmpfs | grep total | awk '{print tolower($3)"m"}'` > $backupfile
